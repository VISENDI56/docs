---
title: PubSub monitoring
description: Real-time alert system with Google Cloud Pub/Sub integration
---

## Overview

iLuminara's PubSub monitoring system provides real-time alerts for outbreak detection, sovereignty violations, and system events using Google Cloud Pub/Sub.

<Card
  title="Latency"
  icon="bolt"
>
  <100ms alert delivery with global distribution
</Card>

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      EVENT SOURCES                  â”‚
â”‚  - Outbreak detection               â”‚
â”‚  - Sovereignty violations           â”‚
â”‚  - High-risk inferences             â”‚
â”‚  - System health                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Publish
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      GOOGLE CLOUD PUB/SUB           â”‚
â”‚  - Topic: outbreak-alerts           â”‚
â”‚  - Topic: sovereignty-violations    â”‚
â”‚  - Topic: system-events             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ Subscribe
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      SUBSCRIBERS                    â”‚
â”‚  - Mobile apps                      â”‚
â”‚  - Dashboard                        â”‚
â”‚  - Email/SMS gateways               â”‚
â”‚  - External systems                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Topics

### outbreak-alerts

Real-time outbreak detection alerts.

**Message format:**

```json
{
  "alert_id": "ALERT_789",
  "timestamp": "2025-12-24T11:00:00.000Z",
  "alert_type": "outbreak_detected",
  "severity": "CRITICAL",
  "location": {
    "lat": 0.4221,
    "lng": 40.2255,
    "name": "Dadaab Refugee Camp"
  },
  "disease": "cholera",
  "metrics": {
    "z_score": 3.2,
    "risk_score": 0.87,
    "case_count": 78,
    "confidence": 0.92
  },
  "recommendations": [
    "Deploy rapid response team",
    "Establish cholera treatment center"
  ],
  "bond_status": {
    "triggered": true,
    "payout_usd": 250000
  }
}
```

### sovereignty-violations

Alerts for data sovereignty violations.

**Message format:**

```json
{
  "violation_id": "VIOL_456",
  "timestamp": "2025-12-24T11:00:00.000Z",
  "violation_type": "cross_border_transfer",
  "severity": "HIGH",
  "action_blocked": true,
  "details": {
    "attempted_action": "Data_Transfer",
    "source_zone": "africa-south1",
    "destination_zone": "us-central1",
    "data_type": "PHI",
    "jurisdiction": "KDPR_KE",
    "violated_framework": "GDPR Art. 9"
  },
  "actor": {
    "user_id": "USER_123",
    "ip_address": "192.168.1.100",
    "location": "Nairobi, Kenya"
  }
}
```

### system-events

System health and operational events.

**Message format:**

```json
{
  "event_id": "EVENT_123",
  "timestamp": "2025-12-24T11:00:00.000Z",
  "event_type": "component_degraded",
  "severity": "WARNING",
  "component": "database",
  "details": {
    "status": "degraded",
    "latency_ms": 500,
    "threshold_ms": 200,
    "error": "High latency detected"
  }
}
```

## Subscribe to topics

### Python

```python
from google.cloud import pubsub_v1
import json

# Initialize subscriber
subscriber = pubsub_v1.SubscriberClient()
subscription_path = subscriber.subscription_path(
    'iluminara-health',
    'outbreak-alerts-sub'
)

def callback(message):
    """Handle incoming alert"""
    alert = json.loads(message.data.decode('utf-8'))
    
    print(f"ðŸš¨ ALERT: {alert['alert_type']}")
    print(f"   Location: {alert['location']['name']}")
    print(f"   Severity: {alert['severity']}")
    print(f"   Z-Score: {alert['metrics']['z_score']}")
    
    if alert['bond_status']['triggered']:
        print(f"   ðŸ’° Bond payout: ${alert['bond_status']['payout_usd']:,}")
    
    # Acknowledge message
    message.ack()

# Subscribe
streaming_pull_future = subscriber.subscribe(
    subscription_path,
    callback=callback
)

print(f"Listening for alerts on {subscription_path}...")

try:
    streaming_pull_future.result()
except KeyboardInterrupt:
    streaming_pull_future.cancel()
```

### JavaScript (Node.js)

```javascript
const {PubSub} = require('@google-cloud/pubsub');

// Initialize subscriber
const pubsub = new PubSub({projectId: 'iluminara-health'});
const subscription = pubsub.subscription('outbreak-alerts-sub');

// Handle incoming alerts
subscription.on('message', message => {
  const alert = JSON.parse(message.data.toString());
  
  console.log(`ðŸš¨ ALERT: ${alert.alert_type}`);
  console.log(`   Location: ${alert.location.name}`);
  console.log(`   Severity: ${alert.severity}`);
  console.log(`   Z-Score: ${alert.metrics.z_score}`);
  
  if (alert.bond_status.triggered) {
    console.log(`   ðŸ’° Bond payout: $${alert.bond_status.payout_usd.toLocaleString()}`);
  }
  
  // Acknowledge message
  message.ack();
});

console.log('Listening for alerts...');
```

### Go

```go
package main

import (
    "context"
    "encoding/json"
    "fmt"
    "log"
    
    "cloud.google.com/go/pubsub"
)

type Alert struct {
    AlertID   string `json:"alert_id"`
    AlertType string `json:"alert_type"`
    Severity  string `json:"severity"`
    Location  struct {
        Name string `json:"name"`
    } `json:"location"`
    Metrics struct {
        ZScore float64 `json:"z_score"`
    } `json:"metrics"`
}

func main() {
    ctx := context.Background()
    
    // Initialize subscriber
    client, err := pubsub.NewClient(ctx, "iluminara-health")
    if err != nil {
        log.Fatal(err)
    }
    defer client.Close()
    
    sub := client.Subscription("outbreak-alerts-sub")
    
    // Subscribe
    err = sub.Receive(ctx, func(ctx context.Context, msg *pubsub.Message) {
        var alert Alert
        if err := json.Unmarshal(msg.Data, &alert); err != nil {
            log.Printf("Error parsing alert: %v", err)
            msg.Nack()
            return
        }
        
        fmt.Printf("ðŸš¨ ALERT: %s\n", alert.AlertType)
        fmt.Printf("   Location: %s\n", alert.Location.Name)
        fmt.Printf("   Severity: %s\n", alert.Severity)
        fmt.Printf("   Z-Score: %.2f\n", alert.Metrics.ZScore)
        
        msg.Ack()
    })
    
    if err != nil {
        log.Fatal(err)
    }
}
```

## Publish alerts

### From API service

```python
from google.cloud import pubsub_v1
import json

# Initialize publisher
publisher = pubsub_v1.PublisherClient()
topic_path = publisher.topic_path('iluminara-health', 'outbreak-alerts')

# Publish alert
alert = {
    'alert_id': 'ALERT_789',
    'timestamp': '2025-12-24T11:00:00.000Z',
    'alert_type': 'outbreak_detected',
    'severity': 'CRITICAL',
    'location': {
        'lat': 0.4221,
        'lng': 40.2255,
        'name': 'Dadaab Refugee Camp'
    },
    'disease': 'cholera',
    'metrics': {
        'z_score': 3.2,
        'risk_score': 0.87,
        'case_count': 78
    }
}

# Publish
future = publisher.publish(
    topic_path,
    data=json.dumps(alert).encode('utf-8'),
    alert_type='outbreak_detected',
    severity='CRITICAL'
)

message_id = future.result()
print(f"Published alert: {message_id}")
```

### From outbreak prediction

```python
@app.route('/predict', methods=['POST'])
def predict_outbreak():
    data = request.json
    
    # Generate prediction
    prediction = generate_prediction(data)
    
    # Publish alert if high risk
    if prediction['risk_level'] in ['HIGH', 'CRITICAL']:
        alert = {
            'alert_id': generate_alert_id(),
            'timestamp': datetime.utcnow().isoformat(),
            'alert_type': 'outbreak_detected',
            'severity': prediction['risk_level'],
            'location': data['location'],
            'metrics': prediction['metrics']
        }
        
        publish_alert('outbreak-alerts', alert)
    
    return jsonify(prediction)
```

## Filtering messages

### By severity

```python
# Subscribe only to CRITICAL alerts
subscription = pubsub.subscription(
    'outbreak-alerts-sub',
    filter='attributes.severity="CRITICAL"'
)
```

### By location

```python
# Subscribe only to alerts from specific region
subscription = pubsub.subscription(
    'outbreak-alerts-sub',
    filter='attributes.region="Garissa"'
)
```

### By disease

```python
# Subscribe only to cholera alerts
subscription = pubsub.subscription(
    'outbreak-alerts-sub',
    filter='attributes.disease="cholera"'
)
```

## Dead letter queue

Handle failed message processing:

```python
from google.cloud import pubsub_v1

# Create subscription with dead letter policy
subscriber = pubsub_v1.SubscriberClient()

subscription_path = subscriber.subscription_path(
    'iluminara-health',
    'outbreak-alerts-sub'
)

dead_letter_topic = subscriber.topic_path(
    'iluminara-health',
    'outbreak-alerts-dlq'
)

# Configure dead letter policy
dead_letter_policy = pubsub_v1.types.DeadLetterPolicy(
    dead_letter_topic=dead_letter_topic,
    max_delivery_attempts=5
)

subscription = subscriber.create_subscription(
    request={
        'name': subscription_path,
        'topic': topic_path,
        'dead_letter_policy': dead_letter_policy
    }
)
```

## Monitoring

### Metrics

```python
from google.cloud import monitoring_v3

# Get subscription metrics
client = monitoring_v3.MetricServiceClient()

# Unacknowledged messages
query = client.query_time_series(
    request={
        'name': f'projects/iluminara-health',
        'filter': 'metric.type="pubsub.googleapis.com/subscription/num_undelivered_messages"',
        'interval': interval,
        'view': monitoring_v3.ListTimeSeriesRequest.TimeSeriesView.FULL
    }
)

for result in query:
    print(f"Unacknowledged: {result.points[0].value.int64_value}")
```

### Alerting

```yaml
# alerting-policy.yaml
displayName: "High Unacknowledged Messages"
conditions:
  - displayName: "Unacknowledged > 100"
    conditionThreshold:
      filter: 'metric.type="pubsub.googleapis.com/subscription/num_undelivered_messages"'
      comparison: COMPARISON_GT
      thresholdValue: 100
      duration: 300s
notificationChannels:
  - "projects/iluminara-health/notificationChannels/email"
```

## Security

### IAM permissions

```bash
# Grant publish permission
gcloud pubsub topics add-iam-policy-binding outbreak-alerts \
  --member="serviceAccount:api@iluminara-health.iam.gserviceaccount.com" \
  --role="roles/pubsub.publisher"

# Grant subscribe permission
gcloud pubsub subscriptions add-iam-policy-binding outbreak-alerts-sub \
  --member="serviceAccount:dashboard@iluminara-health.iam.gserviceaccount.com" \
  --role="roles/pubsub.subscriber"
```

### Message encryption

```python
# Publish with encryption
from google.cloud import kms

# Encrypt message
kms_client = kms.KeyManagementServiceClient()
key_name = kms_client.crypto_key_path(
    'iluminara-health',
    'global',
    'iluminara-keyring',
    'pubsub-key'
)

encrypted_data = kms_client.encrypt(
    request={'name': key_name, 'plaintext': message_data}
)

# Publish encrypted message
publisher.publish(topic_path, data=encrypted_data.ciphertext)
```

## Next steps

<CardGroup cols={2}>
  <Card
    title="Outbreak prediction"
    icon="chart-line"
    href="/api-reference/outbreak-prediction"
  >
    Generate predictions that trigger alerts
  </Card>
  <Card
    title="Voice processing"
    icon="microphone"
    href="/api-reference/voice-processing"
  >
    Process voice alerts
  </Card>
  <Card
    title="Governance"
    icon="shield-check"
    href="/governance/overview"
  >
    Sovereignty violation alerts
  </Card>
  <Card
    title="Deployment"
    icon="rocket"
    href="/deployment/overview"
  >
    Deploy PubSub infrastructure
  </Card>
</CardGroup>
