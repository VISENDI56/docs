---
title: Branch protection setup
description: Automate GitHub branch protection for the Sovereign Health Fortress
---

## Overview

The branch protection setup script automates the configuration of GitHub security rules, ensuring all commits to `main` pass security scans and require code review.

<Card
  title="Automation"
  icon="shield-halved"
>
  One-command setup for complete branch protection and security features
</Card>

## Quick setup

```bash
# Make script executable
chmod +x scripts/setup_branch_protection.sh

# Run setup
./scripts/setup_branch_protection.sh
```

## What it does

<Steps>
  <Step title="Authenticate">
    Verifies GitHub CLI authentication and refreshes permissions
  </Step>
  <Step title="Branch protection">
    Configures protection rules for the `main` branch
  </Step>
  <Step title="Security features">
    Enables Dependabot, secret scanning, and push protection
  </Step>
  <Step title="Verification">
    Displays complete security configuration summary
  </Step>
</Steps>

## Prerequisites

### Install GitHub CLI

```bash
# macOS
brew install gh

# Linux
curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null
sudo apt update
sudo apt install gh

# Windows
winget install --id GitHub.cli
```

### Authenticate

```bash
gh auth login
```

### Refresh permissions

```bash
gh auth refresh -s workflow,repo,write:packages,admin:repo_hook
```

## Branch protection rules

The script configures the following rules for `main`:

### Required status checks

<AccordionGroup>
  <Accordion title="CodeQL Security Analysis">
    SAST scanning for Python and JavaScript code
  </Accordion>
  <Accordion title="Gitleaks Secret Scanning">
    Detects hardcoded secrets and credentials
  </Accordion>
</AccordionGroup>

### Pull request requirements

- **1 approving review** required before merge
- **Dismiss stale reviews** on new commits
- **Require conversation resolution** before merge
- **No force pushes** allowed
- **No branch deletion** allowed

### Administrator enforcement

Branch protection rules apply to **all users**, including administrators.

## Security features enabled

### Dependabot security updates

Automatically creates PRs for security vulnerabilities in dependencies.

```yaml
# .github/dependabot.yml
version: 2
updates:
  - package-ecosystem: "pip"
    directory: "/"
    schedule:
      interval: "daily"
```

### Dependabot alerts

Notifies maintainers of known security vulnerabilities.

### Secret scanning

Scans repository for exposed secrets (requires GitHub Advanced Security).

### Secret scanning push protection

Blocks commits containing secrets from being pushed.

## Manual configuration

If you prefer manual setup, follow these steps:

### 1. Enable branch protection

```bash
gh api \
  --method PUT \
  -H "Accept: application/vnd.github+json" \
  "/repos/OWNER/REPO/branches/main/protection" \
  -f required_status_checks[strict]=true \
  -f "required_status_checks[contexts][]=CodeQL" \
  -f "required_status_checks[contexts][]=Gitleaks Secret Scanning"
```

### 2. Enable Dependabot

```bash
# Security updates
gh api --method PUT \
  "/repos/OWNER/REPO/automated-security-fixes"

# Alerts
gh api --method PUT \
  "/repos/OWNER/REPO/vulnerability-alerts"
```

### 3. Enable secret scanning

```bash
# Secret scanning
gh api --method PUT \
  "/repos/OWNER/REPO/secret-scanning"

# Push protection
gh api --method PUT \
  "/repos/OWNER/REPO/secret-scanning/push-protection"
```

## Verification

After running the script, verify the configuration:

### Check branch protection

```bash
gh api "/repos/OWNER/REPO/branches/main/protection"
```

### Check security features

```bash
# Dependabot status
gh api "/repos/OWNER/REPO/automated-security-fixes"

# Secret scanning status
gh api "/repos/OWNER/REPO/secret-scanning"
```

## Workflow integration

The branch protection rules integrate with GitHub Actions workflows:

```yaml
# .github/workflows/codeql.yml
name: "CodeQL Security Analysis"

on:
  push:
    branches: [ "main", "develop" ]
  pull_request:
    branches: [ "main" ]

jobs:
  analyze:
    runs-on: ubuntu-latest
    # ... CodeQL analysis steps
```

## Troubleshooting

### Permission denied

```bash
# Error: Resource not accessible by integration
# Solution: Refresh permissions
gh auth refresh -s workflow,repo,write:packages,admin:repo_hook
```

### GitHub Advanced Security required

Some features (secret scanning, push protection) require GitHub Advanced Security:

- **Public repositories**: Free
- **Private repositories**: Requires GitHub Enterprise or Advanced Security license

### Status checks not found

Ensure workflows have run at least once:

```bash
# Trigger CodeQL workflow
git commit --allow-empty -m "trigger: CodeQL scan"
git push
```

## Best practices

<AccordionGroup>
  <Accordion title="Run security scans before merging">
    Always wait for CodeQL and Gitleaks to complete before merging PRs
  </Accordion>
  <Accordion title="Review Dependabot PRs promptly">
    Security updates should be reviewed and merged within 24 hours
  </Accordion>
  <Accordion title="Never bypass branch protection">
    Even administrators should follow the same rules
  </Accordion>
  <Accordion title="Monitor security alerts">
    Set up notifications for Dependabot and secret scanning alerts
  </Accordion>
</AccordionGroup>

## Script output

```bash
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘     iLuminara-Core Branch Protection Setup                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ” Checking GitHub authentication... âœ“ AUTHENTICATED
ğŸ”‘ Refreshing GitHub permissions... âœ“ PERMISSIONS GRANTED

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Configuring Branch Protection for 'main'
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¦ Repository: VISENDI56/iLuminara-Core

ğŸ›¡ï¸ Enabling branch protection rules...

âœ… Branch protection rules applied

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Branch Protection Summary
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Required status checks:
  - CodeQL Security Analysis
  - Gitleaks Secret Scanning

âœ“ Pull request requirements:
  - 1 approving review required
  - Dismiss stale reviews on new commits
  - Require conversation resolution

âœ“ Restrictions:
  - Force pushes: BLOCKED
  - Branch deletion: BLOCKED
  - Enforce for administrators: YES

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Enabling Security Features
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¤– Enabling Dependabot security updates... âœ“ ENABLED
ğŸ”” Enabling Dependabot alerts... âœ“ ENABLED
ğŸ” Enabling secret scanning... âœ“ ENABLED
ğŸ›¡ï¸ Enabling secret scanning push protection... âœ“ ENABLED

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    FORTRESS SECURED                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ›¡ï¸ The Sovereign Health Fortress is now protected
```

## Next steps

<CardGroup cols={2}>
  <Card
    title="Validate fortress"
    icon="check-circle"
    href="/deployment/checklist"
  >
    Run complete validation
  </Card>
  <Card
    title="Security workflows"
    icon="workflow"
    href="/security/overview"
  >
    Understand security stack
  </Card>
  <Card
    title="Deploy to GCP"
    icon="google"
    href="/deployment/gcp"
  >
    Production deployment
  </Card>
  <Card
    title="Governance"
    icon="shield-check"
    href="/governance/overview"
  >
    Configure compliance
  </Card>
</CardGroup>
