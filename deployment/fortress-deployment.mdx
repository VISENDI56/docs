---
title: Fortress deployment
description: Deploy the complete Sovereign Health Fortress with Nuclear IP Stack
---

## Overview

This guide walks you through deploying the complete iLuminara-Core Sovereign Health Fortress, including all security workflows, governance kernel, and Nuclear IP Stack components.

<Card
  title="Deployment time"
  icon="clock"
>
  **30-45 minutes** for complete fortress deployment
</Card>

## Prerequisites

<Steps>
  <Step title="GitHub repository access">
    Clone the iLuminara-Core repository
  </Step>
  <Step title="GitHub CLI installed">
    Install `gh` CLI for workflow management
  </Step>
  <Step title="Python 3.8+">
    Python environment with pip
  </Step>
  <Step title="Google Cloud Project (optional)">
    For cloud deployment features
  </Step>
</Steps>

## Step 1: Elevate agent permissions

Grant necessary permissions for security workflows:

```bash
gh auth refresh -s workflow,repo,write:packages,admin:repo_hook
```

This enables:
- **workflow** - Manage GitHub Actions workflows
- **repo** - Full repository access
- **write:packages** - Publish packages
- **admin:repo_hook** - Manage webhooks

## Step 2: Deploy security audit layer

### CodeQL SAST scanning

Create `.github/workflows/codeql.yml`:

```yaml
name: "CodeQL Security Analysis"

on:
  push:
    branches: [ "main", "develop" ]
  pull_request:
    branches: [ "main" ]
  schedule:
    - cron: '0 0 * * 0'  # Weekly

jobs:
  analyze:
    name: Analyze (${{ matrix.language }})
    runs-on: ubuntu-latest
    permissions:
      security-events: write
      packages: read
      actions: read
      contents: read

    strategy:
      fail-fast: false
      matrix:
        language: [ 'python', 'javascript' ]

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Initialize CodeQL
      uses: github/codeql-action/init@v3
      with:
        languages: ${{ matrix.language }}
        queries: +security-extended,security-and-quality

    - name: Autobuild
      uses: github/codeql-action/autobuild@v3

    - name: Perform CodeQL Analysis
      uses: github/codeql-action/analyze@v3
```

### Gitleaks secret scanning

Create `.github/workflows/gitleaks.yml`:

```yaml
name: "Gitleaks Secret Scanning"

on:
  push:
    branches: [ "main", "develop" ]
  schedule:
    - cron: '0 2 * * *'  # Daily at 2 AM UTC

jobs:
  scan:
    name: Gitleaks Secret Detection
    runs-on: ubuntu-latest
    permissions:
      contents: read
      security-events: write

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Run Gitleaks
      uses: gitleaks/gitleaks-action@v2
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

### Dependabot configuration

Create `.github/dependabot.yml`:

```yaml
version: 2

updates:
  - package-ecosystem: "pip"
    directory: "/"
    schedule:
      interval: "daily"
      time: "02:00"
      timezone: "UTC"
    open-pull-requests-limit: 10
    labels:
      - "dependencies"
      - "security"
      - "fortress-maintenance"
```

## Step 3: Deploy governance kernel

### Install dependencies

```bash
pip install -r requirements.txt
```

Key dependencies:
- `cryptography` - Crypto Shredder (IP-02)
- `google-cloud-spanner` - Tamper-proof audit
- `google-cloud-kms` - Key management
- `pyyaml` - Configuration

### Configure SovereignGuardrail

Create `config/sovereign_guardrail.yaml`:

```yaml
jurisdiction:
  primary: "KDPA_KE"
  secondary:
    - "GDPR_EU"
    - "POPIA_ZA"
    - "HIPAA_US"

sovereignty:
  data_residency:
    enabled: true
    allowed_zones:
      - "africa-south1"
      - "europe-west1"
    enforcement_level: "STRICT"

audit:
  enabled: true
  tamper_proof: true
  storage:
    backend: "Cloud_Spanner"
    retention_days: 2555  # 7 years (HIPAA)
```

### Initialize Crypto Shredder

```python
from governance_kernel.crypto_shredder import CryptoShredder, SovereigntyZone

shredder = CryptoShredder(
    sovereignty_zone=SovereigntyZone.KENYA,
    enable_audit=True
)

# Test encryption
encrypted_data, key_id = shredder.encrypt_with_ephemeral_key(
    data=b"Test data",
    retention_policy=RetentionPolicy.HOT
)

print(f"✅ Crypto Shredder initialized - Key ID: {key_id}")
```

## Step 4: Deploy edge node

### Configure environment

```bash
export NODE_ID=JOR-47
export JURISDICTION=KDPA_KE
export ENABLE_OFFLINE_MODE=true
export SYNC_INTERVAL_SECONDS=300
```

### Launch FRENASA Engine

```bash
# Start voice processing service
python edge_node/frenasa_engine/voice_processor.py
```

### Deploy AI agents

```python
from edge_node.ai_agents import AgentOrchestrator

orchestrator = AgentOrchestrator(
    location="Nairobi",
    population_size=100000,
    enable_compliance_checking=True
)

# Start autonomous surveillance
orchestrator.start()
```

## Step 5: Deploy cloud oracle (optional)

### Enable GCP services

```bash
gcloud services enable \
  bigquery.googleapis.com \
  aiplatform.googleapis.com \
  spanner.googleapis.com \
  cloudkms.googleapis.com
```

### Deploy to Cloud Run

```bash
chmod +x deploy_gcp_prototype.sh
./deploy_gcp_prototype.sh
```

This deploys:
- FRENASA AI Engine (Cloud Run)
- HSTPU Forecaster (Vertex AI)
- HSML Ledger (Cloud Spanner)
- Dashboard (Cloud Run)

## Step 6: Validate fortress

Run the comprehensive validation script:

```bash
chmod +x scripts/validate_fortress.sh
./scripts/validate_fortress.sh
```

**Validation phases:**
1. ✅ Security Audit Layer (CodeQL, Gitleaks, Dependabot)
2. ✅ Governance Kernel (SovereignGuardrail, Crypto Shredder)
3. ✅ Edge Node & AI Agents
4. ✅ Cloud Oracle
5. ✅ Python Dependencies
6. ✅ Environment Configuration
7. ✅ Nuclear IP Stack Status

## Step 7: Enable branch protection

Protect the main branch with required status checks:

```bash
gh api repos/:owner/:repo/branches/main/protection \
  --method PUT \
  --field required_status_checks[strict]=true \
  --field required_status_checks[contexts][]=CodeQL \
  --field required_status_checks[contexts][]=Gitleaks \
  --field required_pull_request_reviews[required_approving_review_count]=1
```

## Step 8: Launch services

### Option 1: Auto-launch all services

```bash
chmod +x launch_all_services.sh
./launch_all_services.sh
```

This launches:
- **3 Streamlit Dashboards** (Ports 8501-8503)
- **API Service** (Port 8080)
- **Docker Services** (if available)

### Option 2: Manual launch

```bash
# Launch API
python api_service.py &

# Launch dashboard
streamlit run dashboard.py --server.port 8501 &

# Launch transparency audit
streamlit run transparency_view.py --server.port 8502 &

# Launch field validation
streamlit run field_validation_form.py --server.port 8503 &
```

## Step 9: Test the fortress

### Test voice processing

```bash
# Generate test audio
python generate_test_audio.py

# Process voice alert
curl -X POST http://localhost:8080/process-voice \
  -H "Content-Type: audio/wav" \
  --data-binary @swahili-symptom.wav
```

### Test governance kernel

```python
from governance_kernel.vector_ledger import SovereignGuardrail

guardrail = SovereignGuardrail()

# Try to violate sovereignty
try:
    guardrail.validate_action(
        action_type='Data_Transfer',
        payload={'data_type': 'PHI', 'destination': 'AWS_US'},
        jurisdiction='GDPR_EU'
    )
except SovereigntyViolationError as e:
    print(f"✅ Sovereignty protected: {e}")
```

### Test outbreak simulation

```bash
# Generate outbreak
python edge_node/frenasa_engine/simulate_outbreak.py

# View dashboard
open http://localhost:8501
```

## Nuclear IP Stack status

After deployment, verify all Nuclear IP components:

| Component | Status | Description |
|-----------|--------|-------------|
| **IP-02: Crypto Shredder** | ✅ Active | Data dissolution operational |
| **IP-03: Acorn Protocol** | ⚠️ Hardware Required | Somatic authentication |
| **IP-04: Silent Flux** | ⚠️ Integration Required | Anxiety regulation |
| **IP-05: Golden Thread** | ✅ Active | Data fusion operational |
| **IP-06: 5DM Bridge** | ⚠️ Mobile Network Required | Mobile integration |

## Monitoring & alerts

### Prometheus metrics

Access metrics at `http://localhost:9090/metrics`:

```
sovereignty_violations_total
cross_border_transfers_total
high_risk_inferences_total
keys_shredded_total
```

### Grafana dashboards

Access dashboards at `http://localhost:3000`:

- **Sovereignty Compliance** - Real-time compliance monitoring
- **Audit Trail** - Tamper-proof audit visualization
- **Data Retention** - Key lifecycle and auto-shred status

## Troubleshooting

<AccordionGroup>
  <Accordion title="CodeQL workflow fails">
    **Solution:** Ensure repository has `security-events: write` permission
    
    ```bash
    gh api repos/:owner/:repo/actions/permissions \
      --method PUT \
      --field enabled=true
    ```
  </Accordion>
  
  <Accordion title="Gitleaks finds false positives">
    **Solution:** Add to `.gitleaks.toml` allowlist
    
    ```toml
    [allowlist]
    paths = [
      '''.*_test\\.py''',
      '''.*\\.example'''
    ]
    ```
  </Accordion>
  
  <Accordion title="Crypto Shredder key storage full">
    **Solution:** Run auto-shred for expired keys
    
    ```python
    shredder.auto_shred_expired_keys()
    ```
  </Accordion>
  
  <Accordion title="AI agents not syncing">
    **Solution:** Check connectivity and sync interval
    
    ```python
    agent.connectivity.set_connectivity(True)
    agent.check_and_sync()
    ```
  </Accordion>
</AccordionGroup>

## Production checklist

<Steps>
  <Step title="Security workflows enabled">
    ✅ CodeQL, Gitleaks, Dependabot active
  </Step>
  <Step title="Branch protection configured">
    ✅ Main branch requires PR reviews and status checks
  </Step>
  <Step title="Governance kernel operational">
    ✅ SovereignGuardrail enforcing 14 frameworks
  </Step>
  <Step title="Crypto Shredder initialized">
    ✅ Auto-shred enabled for expired keys
  </Step>
  <Step title="Edge node deployed">
    ✅ AI agents operational with offline capability
  </Step>
  <Step title="Monitoring enabled">
    ✅ Prometheus + Grafana dashboards active
  </Step>
  <Step title="Audit trail verified">
    ✅ Tamper-proof logging with Cloud Spanner
  </Step>
  <Step title="Fortress validated">
    ✅ All validation phases passed
  </Step>
</Steps>

## Next steps

<CardGroup cols={2}>
  <Card
    title="Security monitoring"
    icon="chart-line"
    href="/security/monitoring"
  >
    Set up alerts and dashboards
  </Card>
  <Card
    title="Incident response"
    icon="siren"
    href="/security/incident-response"
  >
    Emergency response procedures
  </Card>
  <Card
    title="Compliance audit"
    icon="file-contract"
    href="/governance/audit"
  >
    Run compliance audits
  </Card>
  <Card
    title="Scale deployment"
    icon="arrows-maximize"
    href="/deployment/scaling"
  >
    Scale to production workloads
  </Card>
</CardGroup>

## Support

For deployment issues:
- **GitHub Issues:** https://github.com/VISENDI56/iLuminara-Core/issues
- **Documentation:** https://docs.iluminara.health
- **Security:** security@iluminara.health
